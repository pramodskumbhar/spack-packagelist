axis:
  - architecture
  - compiler
  - mpi
  - lapack
  - python

combinations:
  core:
    architecture:
    - 'linux-rhel6-x86_64'
    compiler:
    - 'gcc@4.4.7'
    mpi: None
    lapack: None
    python: None
  gnu:
    architecture:
      - 'linux-rhel6-x86_64'
    compiler: 'gcc-5.3.0'
    mpi:
      - 'openmpi@2.1.1+thread_multiple~cuda fabrics=verbs schedulers=slurm:mvapich2@2.2b+psm+slurm:mvapich2@2.2~cuda fabrics=psm process_managers=slurm threads=multiple'
    lapack: 'openblas@0.2.20~openmp:openblas@0.2.20+openmp'
    python: 'python@3.5.2:python@2.7.13'
  intel:
    architecture: 'linux-rhel6-x86_64'
    compiler: 'intel@17.0.0.1'
    mpi: 'intel-mpi@2017.3.196'
    lapack: 'mkl'
    python: 'python@3.5.2:python@2.7.13'
  pgi:
    architecture: 'linux-rhel6-x86_64'
    compiler: 'pgi@17.7'
    mpi: 'mpich@3.2+hydra+pmi+romio~verbs'
    lapack: 'openblas@0.2.20~openmp:openblas@0.2.20+openmp'
    python: 'python@3.5.2:python@2.7.13'
  llvm:
    architecture: 'linux-rhel6-x86_64'
    compiler: 'llvm@4.0.1'
    mpi: 'mpich@3.2+hydra+pmi+romio~verbs'
    lapack: 'openblas@0.2.20~openmp:openblas@0.2.20+openmp'
    python: 'python@3.5.2:python@2.7.13'
  gnucuda7:
    architecture: 'linux-rhel6-x86_64'
    compiler: 'gcc@5.3.0'
    mpi: None
    lapack: 'openblas@0.2.20~openmp'
    python: 'python@3.5.2:python@2.7.13'

packages:
  core:
    target_matrix:
      - core
    requires:
      - architecture
      - compiler
    specs:
      - cmake@3.8.2
      - cmake@3.1.0
      - lmod@7.4.11
      - scala@2.20.6
      - spark@2.1.0+hadoop
  serial:
    target_matrix:
      - gnu
      - intel
    requires:
      - architecture
      - compiler
    specs:
      - valgrind@3.12.0~boost~mpi
      - gdb@7.12.1
      - gsl@2.3
      - hdf5@1.8.16+szip~fortran~mpi
      - hdf5@1.10.1+szip~fortran~mpi
      - python@3.5.2
      - python@2.7.13
  'serial::python':
    target_matrix:
      - gnu
      - intel
    requires:
      - architecture
      - compiler
      - python
    specs:
      - py-cython@0.25.2
      - py-pip@9.0.1
      - py-sympy@1.0
      - py-ply@3.8
      - py-virtualenv@15.1.0
      - py-pytest@3.0.7
  'serial::gnu':
    target_matrix:
      - gnu
    requires:
      - architecture
      - compiler
    specs:
      - qt@4.8.6
      - qt@5.8.0
  'mpi::gnu::intel':
    target_matrix:
      - gnu
      - intel
    requires:
      - architecture
      - compiler
      - mpi
    specs:
      - boost@1.64.0+mpi+python^python@2.7.13
      - hdf5@1.8.16+mpi~cxx~fortran+szip
  'mpi::libs::all':
    target_matrix:
      - gnu
      - intel
      - pgi
      - llvm
    requires:
      - architecture
      - compiler
    specs:
      - openmpi@2.1.1+thread_multiple~cuda fabrics=verbs schedulers=slurm
      - mvapich2@2.2~cuda fabrics=psm process_managers=slurm threads=multiple
      - mpich@3.2+hydra+pmi+romio~verbs
      - intel-mpi@2017.3.196
  'mpi::gnu::intel::pgi':
    target_matrix:
      - gnu
      - intel
      - pgi
    requires:
      - architecture
      - compiler
      - mpi
    specs:
      - tau@2.26.3
      - scorep@3.1
  'mpi::lapack::gnu':
    target_matrix:
      - gnu
    requires:
      - architecture
      - compiler
      - mpi
      - lapack
    specs:
      - netlib-scalapack@2.0.2
  'serial::lapack~openmp::gnu':
    target_matrix:
      - gnu
    target_filter:
      lapack: ['openblas@0.2.20~openmp']
    requires:
      - architecture
      - compiler
      - lapack
    specs:
      - caffe ^hdf5@1.8.16+szip ^py-numpy+blas+lapack
  'mpi::lapack::intel':
    target_matrix:
      - intel
    requires:
      - architecture
      - compiler
      - mpi
      - lapack
    specs:
      - petsc@3.6.3+boost+double+hdf5+metis+mpi+mumps~superlu-dist~hypre
  cuda7:
    target_matrix:
      - gnucuda7
    requires:
      - architecture
      - compiler
    specs:
      - cuda@7.5.18
      - cudnn@5.1 ^cuda@7.5.18
      - cudnn@6.0 ^cuda@7.5.18
  cuda8:
    target_matrix:
      - gnu
    target_filter:
      lapack: ['openblas@0.2.20~openmp']
    requires:
      - architecture
      - compiler
    specs:
      - cuda@8.0.44
      - cudnn@5.1 ^cuda@8.0.44
  'python::lapack+openmp':
    target_matrix:
      - gnu
      - intel
    target_filter:
      lapack: ['openblas@0.2.20+openmp', 'mkl']
    requires:
      - architecture
      - compiler
      - python
      - lapack
    specs:
      - py-numpy@1.13.1+blas+lapack
      - py-scipy@0.19.1^py-numpy+blas+lapack@1.13.1
      - py-matplotlib@2.0.2^py-numpy+blas+lapack@1.13.1